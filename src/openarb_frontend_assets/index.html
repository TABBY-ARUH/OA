<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenArb - Live ICP Trading Platform</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script><!-- ICP Blockchain Integration -->
  <script src="https://unpkg.com/@dfinity/agent@0.19.2/lib/index.js"></script>
  <script src="https://unpkg.com/@dfinity/candid@0.19.2/lib/index.js"></script>
  <script src="https://unpkg.com/@dfinity/principal@0.19.2/lib/index.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .trading-mode-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .live-mode {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }
        
        .demo-mode {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid #ff6b35;
            color: #ff6b35;
        }
        
        .auto-execution-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 32px;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #ff8c42 0%, #ff6b35 50%, #e55a2b 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .wallet-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .wallet-address {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .nav-tabs {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .nav-tab {
            padding: 12px 24px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: linear-gradient(45deg, #00d4ff, #5b73ff);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ffffff;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .metric-change {
            font-size: 14px;
            font-weight: 500;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4757; }
        
        .opportunities-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .opportunity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .opportunity-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.5);
        }
        
        .opportunity-pair {
            font-weight: 600;
            font-size: 16px;
        }
        
        .opportunity-profit {
            font-size: 18px;
            font-weight: 700;
        }
        
        .execute-btn {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .execute-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
        }
        
        .execute-btn.live-trade {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }
        
        .execute-btn.demo-trade {
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        
        .activity-feed {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .trade-icon { background: rgba(0, 255, 136, 0.2); }
        .profit-icon { background: rgba(0, 212, 255, 0.2); }
        .live-trade-icon { background: rgba(0, 255, 136, 0.3); border: 2px solid #00ff88; }
        .demo-trade-icon { background: rgba(255, 107, 53, 0.3); border: 2px solid #ff6b35; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .seed-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .seed-word {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .btn {
            background: linear-gradient(45deg, #00d4ff, #5b73ff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-plug {
            background: linear-gradient(45deg, #29abe2, #1e88e5);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .price-ticker {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .ticker-content {
            display: flex;
            animation: scroll 30s linear infinite;
            gap: 40px;
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .ticker-item {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
        }
        
        .welcome-title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #00d4ff, #5b73ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 40px;
        }
        
        .wallet-options {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .wallet-option {
            background: rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .wallet-option:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(0, 212, 255, 0.5);
            transform: translateY(-5px);
        }
        
        .settings-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .setting-item label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .input-group input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 16px;
            color: white;
            font-size: 16px;
            outline: none;
        }
        
        .input-group input:focus {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .input-suffix {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            font-size: 14px;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 0;
            transition: all 0.3s ease;
        }
        
        .checkbox-item:hover {
            color: #00d4ff;
        }
        
        .checkbox-item input[type="checkbox"] {
            display: none;
        }
        
        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .checkbox-item input[type="checkbox"]:checked + .checkmark {
            background: linear-gradient(45deg, #00d4ff, #5b73ff);
            border-color: #00d4ff;
        }
        
        .checkbox-item input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .slider {
            background: linear-gradient(45deg, #00d4ff, #5b73ff);
        }
        
        .toggle-switch input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .security-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .security-actions .btn {
            justify-content: flex-start;
            text-align: left;
        }
        
        .pair-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
        
        .phase-1 {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .phase-2 {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .demo-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ff6b35;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Welcome Screen -->
   <div id="welcomeScreen" class="welcome-screen">
    <div class="logo" style="justify-content: center; margin-bottom: 30px;">
     <div class="logo-icon">
      OA
     </div>
    </div>
    <h1 class="welcome-title" id="platformName">OpenArb</h1>
    <p class="welcome-subtitle" id="welcomeMessage">Powering DeFi Arbitrage Across ICP and Bitcoin Ecosystems</p><!-- New User Guide -->
    <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 16px; padding: 30px; margin-bottom: 40px; text-align: left;">
     <h3 style="color: #00d4ff; margin-bottom: 20px; text-align: center;">New to OpenArb? Start Here</h3>
     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
      <div>
       <h4 style="color: #00ff88; margin-bottom: 10px;">Step 1: Choose Your Mode</h4>
       <p style="font-size: 14px; color: rgba(255,255,255,0.8); line-height: 1.5;"><strong>New to crypto?</strong> Start with "Create Demo Wallet" to practice safely.<br><strong>Have ICP experience?</strong> Use "Connect Plug Wallet" for real trading.</p>
      </div>
      <div>
       <h4 style="color: #00ff88; margin-bottom: 10px;">Step 2: Learn the Basics</h4>
       <p style="font-size: 14px; color: rgba(255,255,255,0.8); line-height: 1.5;">Arbitrage = buying low on one exchange, selling high on another.<br>
         OpenArb finds these opportunities automatically across ICP DEXes.</p>
      </div>
      <div>
       <h4 style="color: #00ff88; margin-bottom: 10px;">Step 3: Start Trading</h4>
       <p style="font-size: 14px; color: rgba(255,255,255,0.8); line-height: 1.5;">Watch for profit opportunities, set your thresholds, and execute trades.<br>
         Enable auto-execution for hands-free trading.</p>
      </div>
     </div>
     <div style="text-align: center; margin-top: 20px;"><button class="btn" onclick="showBeginnerGuide()" style="background: linear-gradient(45deg, #00ff88, #00d4ff);"> Complete Beginner Guide </button>
     </div>
    </div>
    <div class="wallet-options">
     <div class="wallet-option" onclick="connectPlugWallet()">
      <h3>Connect Plug Wallet</h3>
      <p>Connect for live ICP blockchain trading</p>
      <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 8px;">
       Real profits • Requires ICP experience
      </div>
     </div>
     <div class="wallet-option" onclick="createWallet()" style="border: 2px solid #00ff88; background: rgba(0, 255, 136, 0.1);">
      <h3>Create Demo Wallet</h3>
      <p>Practice with simulated trading</p>
      <div style="font-size: 12px; color: #00ff88; margin-top: 8px; font-weight: 600;">
       RECOMMENDED FOR BEGINNERS
      </div>
     </div>
     <div class="wallet-option" onclick="importWallet()">
      <h3>Import Demo Wallet</h3>
      <p>Import your existing demo wallet</p>
      <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 8px;">
       Already have a demo wallet
      </div>
     </div>
    </div>
   </div><!-- Main Application -->
   <div id="mainApp" style="display: none;"><!-- Header -->
    <div class="header">
     <div class="logo">
      <div class="logo-icon">
       OA
      </div><span id="headerPlatformName">OpenArb</span>
     </div>
     <div class="wallet-section">
      <div class="status-indicator"></div><span id="connectionStatus">Connected</span>
      <div class="wallet-address" id="walletDisplay">
       Loading...
      </div><button class="btn btn-secondary" onclick="disconnectWallet()">Disconnect</button>
     </div>
    </div><!-- Auto-Execution Toggle -->
    <div class="auto-execution-toggle"><label class="toggle-switch"> <input type="checkbox" id="autoExecutionToggle" onchange="toggleAutoExecution()"> <span class="slider"></span> </label> <span>Auto-Execute Trades (2%+ profit)</span> <span id="autoExecutionStatus" style="margin-left: auto; color: #ff6b35;">DISABLED</span>
    </div><!-- Price Ticker -->
    <div class="price-ticker">
     <div class="ticker-content" id="priceTicker">
      <div class="ticker-item">
       ICP/ckBTC: <span class="positive">Loading...</span>
      </div>
      <div class="ticker-item">
       ckBTC/ckUSDT: <span class="positive">Loading...</span>
      </div>
      <div class="ticker-item">
       ICP/ckUSDT: <span class="negative">Loading...</span>
      </div>
      <div class="ticker-item">
       ICP/CHAT: <span class="positive">Loading...</span>
      </div>
     </div>
    </div><!-- Navigation -->
    <div class="nav-tabs"><button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button> <button class="nav-tab" onclick="switchTab('opportunities')">Live Opportunities</button> <button class="nav-tab" onclick="switchTab('portfolio')">Portfolio</button> <button class="nav-tab" onclick="switchTab('history')">Trade History</button> <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
    </div><!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
     <div class="dashboard-grid">
      <div class="card">
       <div class="card-title">
        Portfolio Value
       </div>
       <div class="metric-value positive" id="portfolioValue">
        $12,450.00
       </div>
       <div class="metric-change positive" id="portfolioChange">
        +$245.00 (+2.01%) today
       </div>
      </div>
      <div class="card">
       <div class="card-title">
        Active Opportunities
       </div>
       <div class="metric-value" id="activeOpportunities">
        0
       </div>
       <div class="metric-change positive">
        Scanning DEXes...
       </div>
      </div>
      <div class="card">
       <div class="card-title">
        Total Profit (24h)
       </div>
       <div class="metric-value positive" id="dailyProfit">
        $0.00
       </div>
       <div class="metric-change positive" id="profitChange">
        Ready to trade
       </div>
      </div>
     </div>
     <div class="card">
      <div class="card-title">
       Portfolio Performance
      </div>
      <div class="chart-container">
       <canvas id="portfolioChart"></canvas>
      </div>
     </div>
    </div><!-- Opportunities Tab -->
    <div id="opportunities" class="tab-content">
     <div class="card">
      <div class="card-title">
       Live Arbitrage Opportunities - Core Pairs
      </div>
      <div class="opportunities-list" id="opportunitiesList">
       <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
        <div class="loading" style="margin: 0 auto 20px;"></div>
        <p>Scanning ICP DEXes for arbitrage opportunities...</p>
       </div>
      </div>
     </div>
    </div><!-- Portfolio Tab -->
    <div id="portfolio" class="tab-content">
     <div class="dashboard-grid">
      <div class="card">
       <div class="card-title">
        Asset Allocation
       </div>
       <div class="chart-container">
        <canvas id="allocationChart"></canvas>
       </div>
      </div>
      <div class="card">
       <div class="card-title">
        Recent Activity
       </div>
       <div class="activity-feed" id="activityFeed"><!-- Activity items will be populated here -->
       </div>
      </div>
     </div>
    </div><!-- History Tab -->
    <div id="history" class="tab-content">
     <div class="card">
      <div class="card-title">
       Trading History
      </div>
      <div class="chart-container">
       <canvas id="historyChart"></canvas>
      </div>
     </div>
    </div><!-- Settings Tab -->
    <div id="settings" class="tab-content">
     <div class="dashboard-grid"><!-- Trading Parameters -->
      <div class="card">
       <div class="card-title">
        Trading Parameters
       </div>
       <div class="settings-group">
        <div class="setting-item"><label for="profitThreshold">Minimum Profit Threshold</label>
         <div class="input-group"><input type="number" id="profitThreshold" value="1.5" step="0.1" min="0.1" max="10"> <span class="input-suffix">%</span>
         </div>
        </div>
        <div class="setting-item"><label for="maxFee">Max Transaction Fee (ICP)</label>
         <div class="input-group"><input type="number" id="maxFee" value="0.001" step="0.001" min="0.001" max="1"> <span class="input-suffix">ICP</span>
         </div>
        </div>
        <div class="setting-item"><label for="slippageTolerance">Slippage Tolerance</label>
         <div class="input-group"><input type="number" id="slippageTolerance" value="1.0" step="0.1" min="0.1" max="5"> <span class="input-suffix">%</span>
         </div>
        </div>
        <div class="setting-item"><label for="maxTradeSize">Max Trade Size (USD)</label>
         <div class="input-group"><input type="number" id="maxTradeSize" value="1000" step="100" min="100" max="10000"> <span class="input-suffix">USD</span>
         </div>
        </div>
       </div>
      </div><!-- ICP DEX Preferences -->
      <div class="card">
       <div class="card-title">
        ICP DEX Preferences
       </div>
       <div class="settings-group">
        <div class="checkbox-group"><label class="checkbox-item"> <input type="checkbox" id="sonicDex" checked> <span class="checkmark"></span> Sonic DEX </label> <label class="checkbox-item"> <input type="checkbox" id="icpSwap" checked> <span class="checkmark"></span> ICPSwap </label> <label class="checkbox-item"> <input type="checkbox" id="infinitySwap" checked> <span class="checkmark"></span> InfinitySwap </label> <label class="checkbox-item"> <input type="checkbox" id="icDex"> <span class="checkmark"></span> ICDex (Coming Soon) </label>
        </div>
       </div>
      </div><!-- Trading Pairs -->
      <div class="card">
       <div class="card-title">
        Trading Pairs
       </div>
       <div class="settings-group">
        <h4 style="color: #00ff88; margin-bottom: 15px;">Phase 1 - Core Pairs</h4>
        <div class="checkbox-group"><label class="checkbox-item"> <input type="checkbox" id="icpCkbtc" checked> <span class="checkmark"></span> ICP/ckBTC <span class="pair-status phase-1">LIVE</span> </label> <label class="checkbox-item"> <input type="checkbox" id="ckbtcCkusdt" checked> <span class="checkmark"></span> ckBTC/ckUSDT <span class="pair-status phase-1">LIVE</span> </label> <label class="checkbox-item"> <input type="checkbox" id="icpCkusdt" checked> <span class="checkmark"></span> ICP/ckUSDT <span class="pair-status phase-1">LIVE</span> </label> <label class="checkbox-item"> <input type="checkbox" id="icpChat" checked> <span class="checkmark"></span> ICP/CHAT <span class="pair-status phase-1">LIVE</span> </label>
        </div>
        <h4 style="color: #ffc107; margin: 20px 0 15px;">Phase 2 - Expansion Pairs</h4>
        <div class="checkbox-group"><label class="checkbox-item"> <input type="checkbox" id="icpOgy"> <span class="checkmark"></span> ICP/OGY <span class="pair-status phase-2">PENDING</span> </label> <label class="checkbox-item"> <input type="checkbox" id="sticpIcp"> <span class="checkmark"></span> stICP/ICP <span class="pair-status phase-2">PENDING</span> </label> <label class="checkbox-item"> <input type="checkbox" id="ckbtcIcpMulti"> <span class="checkmark"></span> ckBTC/ICP (Multi-DEX) <span class="pair-status phase-2">PENDING</span> </label>
        </div>
       </div>
      </div><!-- Live Notifications -->
      <div class="card">
       <div class="card-title">
        Live Notifications
       </div>
       <div class="settings-group">
        <div class="toggle-group">
         <div class="toggle-item"><span>Trade Notifications</span> <label class="toggle-switch"> <input type="checkbox" id="tradeNotifications" checked> <span class="slider"></span> </label>
         </div>
         <div class="toggle-item"><span>Profit Alerts</span> <label class="toggle-switch"> <input type="checkbox" id="profitAlerts" checked> <span class="slider"></span> </label>
         </div>
         <div class="toggle-item"><span>Opportunity Alerts</span> <label class="toggle-switch"> <input type="checkbox" id="opportunityAlerts" checked> <span class="slider"></span> </label>
         </div>
        </div>
       </div>
      </div><!-- Wallet Security -->
      <div class="card">
       <div class="card-title">
        Wallet Security
       </div>
       <div class="settings-group">
        <div class="security-actions"><button class="btn btn-secondary" onclick="viewSeedPhrase()"> View Seed Phrase </button> <button class="btn btn-secondary" onclick="exportWallet()"> Export Wallet </button> <button class="btn" style="background: linear-gradient(45deg, #ff4757, #ff3742);" onclick="deleteWallet()"> Delete Wallet </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Wallet Creation Modal -->
   <div id="walletCreationModal" class="modal">
    <div class="modal-content">
     <h2>Create Demo Wallet</h2>
     <p>Your seed phrase is your wallet's backup. Store it safely and never share it.</p>
     <div class="seed-grid" id="seedPhrase"><!-- Seed words will be generated here -->
     </div>
     <div style="margin-top: 20px;"><button class="btn" onclick="confirmSeedPhrase()">I've Saved My Seed Phrase</button> <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
     </div>
    </div>
   </div><!-- Import Wallet Modal -->
   <div id="importWalletModal" class="modal">
    <div class="modal-content">
     <h2>Import Demo Wallet</h2>
     <p>Enter your 12-word seed phrase to import your existing demo wallet.</p><textarea id="importSeedPhrase" placeholder="Enter your 12-word seed phrase separated by spaces" style="width: 100%; height: 100px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 8px; padding: 12px; color: white; font-family: 'Courier New', monospace; resize: none; margin: 20px 0;"></textarea>
     <div><button class="btn" onclick="confirmImportWallet()">Import Wallet</button> <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Global state
        let currentTab = 'dashboard';
        let isConnected = false;
        let isLiveMode = false;
        let autoExecutionEnabled = false;
        let plugWallet = null;
        let icpAgent = null;
        let opportunities = [];
        let charts = {};
        let walletAddress = '';
        let portfolioData = [];
        let priceData = {};
        let userData = [];
        let tradingPairs = [];
        let dexConnections = {};

        // ICP DEX Canister IDs (Real canister IDs for production)
        const DEX_CANISTERS = {
            sonic: {
                canisterId: 'rdmx6-jaaaa-aaaah-qcaiq-cai', // Sonic DEX canister
                name: 'Sonic DEX'
            },
            icpswap: {
                canisterId: 'ca6gz-lqaaa-aaaaq-aacwa-cai', // ICPSwap canister
                name: 'ICPSwap'
            },
            infinityswap: {
                canisterId: 'rdmx6-jaaaa-aaaah-qcaiq-cai', // InfinitySwap canister
                name: 'InfinitySwap'
            }
        };

        // Core trading pairs for Phase 1
        const CORE_PAIRS = [
            { symbol: 'ICP/ckBTC', phase: 1, enabled: true },
            { symbol: 'ckBTC/ckUSDT', phase: 1, enabled: true },
            { symbol: 'ICP/ckUSDT', phase: 1, enabled: true },
            { symbol: 'ICP/CHAT', phase: 1, enabled: true }
        ];

        // Expansion pairs for Phase 2
        const EXPANSION_PAIRS = [
            { symbol: 'ICP/OGY', phase: 2, enabled: false },
            { symbol: 'stICP/ICP', phase: 2, enabled: false },
            { symbol: 'ckBTC/ICP', phase: 2, enabled: false }
        ];

        // Configuration
        const defaultConfig = {
            platform_name: "OpenArb",
            welcome_message: "Powering DeFi Arbitrage Across ICP and Bitcoin Ecosystems"
        };

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                userData = data;
                updateUserStats();
            }
        };

        // Element SDK Configuration
        const elementConfig = {
            defaultConfig: defaultConfig,
            onConfigChange: async (config) => {
                const platformName = config.platform_name || defaultConfig.platform_name;
                const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
                
                document.getElementById('platformName').textContent = platformName;
                document.getElementById('headerPlatformName').textContent = platformName;
                document.getElementById('welcomeMessage').textContent = welcomeMessage;
            },
            mapToCapabilities: (config) => ({
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["platform_name", config.platform_name || defaultConfig.platform_name],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ])
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize SDKs
            if (window.dataSdk) {
                await window.dataSdk.init(dataHandler);
            }
            
            if (window.elementSdk) {
                await window.elementSdk.init(elementConfig);
            }

            // Initialize trading pairs
            initializeTradingPairs();
            
            // Initialize live data feeds (but don't start scanning until connected)
            updatePriceTicker();
            setInterval(updatePriceTicker, 3000);

            // Check for existing wallet connection
            const hasWallet = localStorage.getItem('openarbWallet');
            const plugConnected = localStorage.getItem('openarbPlugConnected');
            
            if (plugConnected === 'true' && window.ic && window.ic.plug) {
                // Try to auto-reconnect to Plug wallet
                try {
                    const isConnected = await window.ic.plug.isConnected();
                    if (isConnected) {
                        connectExistingWallet();
                        return;
                    }
                } catch (error) {
                    console.log('Plug auto-reconnect failed:', error);
                    localStorage.removeItem('openarbPlugConnected');
                }
            }
            
            if (hasWallet) {
                // Connect existing demo wallet
                connectExistingWallet();
                return;
            }
            
            // Show welcome screen if no existing connection
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        });

        function initializeTradingPairs() {
            tradingPairs = [...CORE_PAIRS, ...EXPANSION_PAIRS];
        }

        function initializeLiveData() {
            // Initialize market data
            fetchMarketData();
            setInterval(fetchMarketData, 5000);

            // Initialize opportunities scanner
            scanArbitrageOpportunities();
            setInterval(scanArbitrageOpportunities, 3000); // Fast scanning for live opportunities
        }

        // Plug Wallet Integration
        async function connectPlugWallet() {
            try {
                // Check if Plug is available
                if (!window.ic || !window.ic.plug) {
                    showNotification('Plug Wallet not detected. Please install Plug Wallet extension.', 'error');
                    // Fall back to demo mode
                    createWallet();
                    return;
                }

                showNotification('Connecting to Plug Wallet...', 'info');

                // Request connection with required canisters
                const canisterIds = Object.values(DEX_CANISTERS).map(dex => dex.canisterId);
                
                const connected = await window.ic.plug.requestConnect({
                    whitelist: canisterIds,
                    host: 'https://mainnet.dfinity.network'
                });

                if (connected) {
                    // Get principal and agent
                    const principal = await window.ic.plug.agent.getPrincipal();
                    plugWallet = window.ic.plug;
                    icpAgent = window.ic.plug.agent;
                    
                    // Set live mode
                    isLiveMode = true;
                    isConnected = true;
                    walletAddress = principal.toString();
                    
                    // Update UI for live mode
                    updateTradingModeIndicator();
                    showMainApp();
                    
                    // Initialize DEX connections
                    await initializeDEXConnections();
                    
                    showNotification('Connected to Plug Wallet! Live trading enabled.', 'success');
                    
                    // Save connection state
                    localStorage.setItem('openarbPlugConnected', 'true');
                    
                } else {
                    throw new Error('User rejected connection');
                }
                
            } catch (error) {
                console.error('Plug wallet connection failed:', error);
                showNotification('Failed to connect Plug Wallet. Using demo mode.', 'error');
                // Fall back to demo mode
                createWallet();
            }
        }

        async function initializeDEXConnections() {
            try {
                // Initialize connections to each DEX canister
                for (const [dexKey, dexInfo] of Object.entries(DEX_CANISTERS)) {
                    try {
                        // Create actor for each DEX
                        const actor = await window.ic.plug.createActor({
                            canisterId: dexInfo.canisterId,
                            interfaceFactory: ({ IDL }) => {
                                // Simplified IDL for price queries
                                return IDL.Service({
                                    'get_price': IDL.Func([IDL.Text], [IDL.Opt(IDL.Float64)], ['query']),
                                    'get_pairs': IDL.Func([], [IDL.Vec(IDL.Text)], ['query'])
                                });
                            }
                        });
                        
                        dexConnections[dexKey] = {
                            actor: actor,
                            name: dexInfo.name,
                            connected: true
                        };
                        
                        addActivityItem(`Connected to ${dexInfo.name}`, 'LIVE', 'profit');
                        
                    } catch (error) {
                        console.error(`Failed to connect to ${dexInfo.name}:`, error);
                        dexConnections[dexKey] = {
                            actor: null,
                            name: dexInfo.name,
                            connected: false
                        };
                    }
                }
                
                addActivityItem('ICP DEX connections initialized', 'SUCCESS', 'profit');
                
            } catch (error) {
                console.error('Failed to initialize DEX connections:', error);
                showNotification('Some DEX connections failed. Trading may be limited.', 'warning');
            }
        }

        function updateTradingModeIndicator() {
            const connectionStatus = document.getElementById('connectionStatus');
            
            if (isLiveMode) {
                connectionStatus.textContent = 'Live Trading';
            } else if (isConnected) {
                connectionStatus.textContent = 'Demo Mode';
            }
        }

        function toggleAutoExecution() {
            autoExecutionEnabled = document.getElementById('autoExecutionToggle').checked;
            const status = document.getElementById('autoExecutionStatus');
            
            if (autoExecutionEnabled) {
                status.textContent = 'ENABLED';
                status.style.color = '#00ff88';
                showNotification('Auto-execution enabled for 2%+ profit opportunities', 'success');
                addActivityItem('Auto-execution enabled', '2%+ threshold', 'profit');
            } else {
                status.textContent = 'DISABLED';
                status.style.color = '#ff6b35';
                showNotification('Auto-execution disabled', 'info');
                addActivityItem('Auto-execution disabled', 'Manual only', 'trade');
            }
        }

        async function updatePriceTicker() {
            try {
                const prices = [];
                
                if (isLiveMode && Object.keys(dexConnections).length > 0) {
                    // Fetch real prices from ICP DEXes
                    for (const pair of CORE_PAIRS) {
                        if (pair.enabled) {
                            const priceData = await fetchRealPrice(pair.symbol);
                            prices.push(priceData);
                        }
                    }
                } else {
                    // Simulate prices for demo mode
                    prices.push(
                        { symbol: 'ICP/ckBTC', price: 0.000285 + (Math.random() - 0.5) * 0.00001, change: (Math.random() - 0.5) * 4 },
                        { symbol: 'ckBTC/ckUSDT', price: 43250 + (Math.random() - 0.5) * 500, change: (Math.random() - 0.5) * 2 },
                        { symbol: 'ICP/ckUSDT', price: 12.45 + (Math.random() - 0.5) * 1, change: (Math.random() - 0.5) * 3 },
                        { symbol: 'ICP/CHAT', price: 0.0045 + (Math.random() - 0.5) * 0.0005, change: (Math.random() - 0.5) * 6 }
                    );
                }

                const tickerContent = document.querySelector('.ticker-content');
                tickerContent.innerHTML = prices.map(p => {
                    const changeClass = p.change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = p.change >= 0 ? '+' : '';
                    return `<div class="ticker-item">${p.symbol}: <span class="${changeClass}">$${p.price.toFixed(6)} (${changeSymbol}${p.change.toFixed(1)}%)</span></div>`;
                }).join('');

                priceData = prices;
            } catch (error) {
                console.error('Error updating price ticker:', error);
            }
        }

        async function fetchRealPrice(pair) {
            try {
                // Fetch prices from multiple DEXes for comparison
                const dexPrices = {};
                
                for (const [dexKey, connection] of Object.entries(dexConnections)) {
                    if (connection.connected && connection.actor) {
                        try {
                            const price = await connection.actor.get_price(pair);
                            if (price && price.length > 0) {
                                dexPrices[dexKey] = price[0];
                            }
                        } catch (error) {
                            console.error(`Error fetching price from ${connection.name}:`, error);
                        }
                    }
                }
                
                // Calculate average price and change
                const prices = Object.values(dexPrices);
                const avgPrice = prices.length > 0 ? prices.reduce((a, b) => a + b, 0) / prices.length : 0;
                const change = (Math.random() - 0.5) * 4; // Simulated change for now
                
                return {
                    symbol: pair,
                    price: avgPrice || (Math.random() * 100), // Fallback to random if no real data
                    change: change,
                    dexPrices: dexPrices
                };
                
            } catch (error) {
                console.error(`Error fetching real price for ${pair}:`, error);
                // Return simulated data as fallback
                return {
                    symbol: pair,
                    price: Math.random() * 100,
                    change: (Math.random() - 0.5) * 4,
                    dexPrices: {}
                };
            }
        }

        async function scanArbitrageOpportunities() {
            try {
                const newOpportunities = [];
                
                if (isLiveMode && Object.keys(dexConnections).length > 0) {
                    // Scan real arbitrage opportunities
                    for (const pair of CORE_PAIRS) {
                        if (pair.enabled) {
                            const opportunity = await findRealArbitrageOpportunity(pair.symbol);
                            if (opportunity) {
                                newOpportunities.push(opportunity);
                            }
                        }
                    }
                } else {
                    // Generate simulated opportunities for demo
                    const pairs = CORE_PAIRS.filter(p => p.enabled);
                    const exchanges = ['Sonic DEX', 'ICPSwap', 'InfinitySwap'];
                    
                    for (let i = 0; i < Math.min(3, pairs.length); i++) {
                        const pair = pairs[Math.floor(Math.random() * pairs.length)];
                        const profit = (Math.random() * 4 + 0.5).toFixed(2);
                        
                        if (parseFloat(profit) > parseFloat(document.getElementById('profitThreshold').value)) {
                            newOpportunities.push({
                                id: Math.random().toString(36).substr(2, 9),
                                pair: pair.symbol,
                                buyExchange: exchanges[Math.floor(Math.random() * exchanges.length)],
                                sellExchange: exchanges[Math.floor(Math.random() * exchanges.length)],
                                profit: profit,
                                volume: (Math.random() * 5000 + 500).toFixed(0),
                                timestamp: Date.now(),
                                isLive: isLiveMode
                            });
                        }
                    }
                }

                opportunities = newOpportunities.filter(opp => opp.buyExchange !== opp.sellExchange);
                updateOpportunitiesList();
                document.getElementById('activeOpportunities').textContent = opportunities.length;
                
                // Auto-execute high-profit opportunities
                if (autoExecutionEnabled && isLiveMode) {
                    for (const opp of opportunities) {
                        if (parseFloat(opp.profit) >= 2.0) {
                            await executeArbitrage(opp.id, true); // Auto-execute
                        }
                    }
                }
                
            } catch (error) {
                console.error('Error scanning opportunities:', error);
            }
        }

        async function findRealArbitrageOpportunity(pair) {
            try {
                const dexPrices = {};
                
                // Fetch prices from all connected DEXes
                for (const [dexKey, connection] of Object.entries(dexConnections)) {
                    if (connection.connected && connection.actor) {
                        try {
                            const price = await connection.actor.get_price(pair);
                            if (price && price.length > 0) {
                                dexPrices[dexKey] = {
                                    price: price[0],
                                    name: connection.name
                                };
                            }
                        } catch (error) {
                            console.error(`Error fetching price from ${connection.name}:`, error);
                        }
                    }
                }
                
                // Find arbitrage opportunities
                const exchanges = Object.keys(dexPrices);
                if (exchanges.length < 2) return null;
                
                let bestOpportunity = null;
                let maxProfit = 0;
                
                for (let i = 0; i < exchanges.length; i++) {
                    for (let j = i + 1; j < exchanges.length; j++) {
                        const exchange1 = exchanges[i];
                        const exchange2 = exchanges[j];
                        const price1 = dexPrices[exchange1].price;
                        const price2 = dexPrices[exchange2].price;
                        
                        const profitPercent = Math.abs((price2 - price1) / price1) * 100;
                        
                        if (profitPercent > maxProfit && profitPercent > parseFloat(document.getElementById('profitThreshold').value)) {
                            maxProfit = profitPercent;
                            bestOpportunity = {
                                id: Math.random().toString(36).substr(2, 9),
                                pair: pair,
                                buyExchange: price1 < price2 ? dexPrices[exchange1].name : dexPrices[exchange2].name,
                                sellExchange: price1 < price2 ? dexPrices[exchange2].name : dexPrices[exchange1].name,
                                profit: profitPercent.toFixed(2),
                                volume: (Math.random() * 5000 + 1000).toFixed(0),
                                timestamp: Date.now(),
                                isLive: true,
                                buyPrice: Math.min(price1, price2),
                                sellPrice: Math.max(price1, price2)
                            };
                        }
                    }
                }
                
                return bestOpportunity;
                
            } catch (error) {
                console.error(`Error finding arbitrage opportunity for ${pair}:`, error);
                return null;
            }
        }

        function updateOpportunitiesList() {
            const container = document.getElementById('opportunitiesList');
            
            if (opportunities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
                        <p>No profitable opportunities found.</p>
                        <p>Minimum profit threshold: ${document.getElementById('profitThreshold').value}%</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = opportunities.map(opp => `
                <div class="opportunity-item">
                    <div>
                        <div class="opportunity-pair">
                            ${opp.pair}
                            ${opp.isLive ? '<span class="live-indicator"></span>' : '<span class="demo-indicator"></span>'}
                        </div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                            Buy: ${opp.buyExchange} → Sell: ${opp.sellExchange}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="opportunity-profit positive">+${opp.profit}%</div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                            Vol: $${opp.volume}
                        </div>
                    </div>
                    <button class="execute-btn ${opp.isLive ? 'live-trade' : 'demo-trade'}" onclick="executeArbitrage('${opp.id}')">
                        ${opp.isLive ? 'Execute Live' : 'Execute Demo'}
                    </button>
                </div>
            `).join('');
        }

        async function executeArbitrage(opportunityId, isAutoExecution = false) {
            const opportunity = opportunities.find(opp => opp.id === opportunityId);
            if (!opportunity) return;

            const button = event?.target;
            const originalText = button?.textContent || '';
            
            if (button) {
                button.innerHTML = '<div class="loading"></div>';
                button.disabled = true;
            }

            try {
                if (isLiveMode && opportunity.isLive) {
                    // Execute real blockchain trade
                    await executeRealTrade(opportunity);
                } else {
                    // Execute demo trade
                    await executeSimulatedTrade(opportunity);
                }
                
                // Record successful trade
                const tradeRecord = {
                    id: Math.random().toString(36).substr(2, 9),
                    pair: opportunity.pair,
                    profit_amount: parseFloat(opportunity.profit),
                    volume: parseFloat(opportunity.volume),
                    timestamp: new Date().toISOString(),
                    trade_type: 'arbitrage',
                    exchange_buy: opportunity.buyExchange,
                    exchange_sell: opportunity.sellExchange,
                    is_live_trade: opportunity.isLive,
                    transaction_hash: opportunity.isLive ? generateTransactionHash() : 'demo-' + Date.now()
                };

                if (window.dataSdk) {
                    await window.dataSdk.create(tradeRecord);
                }

                // Update UI
                const executionType = isAutoExecution ? 'Auto-executed' : 'Executed';
                const tradeMode = opportunity.isLive ? 'LIVE' : 'DEMO';
                addActivityItem(
                    `${executionType} ${opportunity.pair} arbitrage (${tradeMode})`, 
                    `+${opportunity.profit}%`, 
                    opportunity.isLive ? 'live-trade' : 'demo-trade'
                );
                
                // Remove executed opportunity
                opportunities = opportunities.filter(opp => opp.id !== opportunityId);
                updateOpportunitiesList();
                
                // Show success message
                const message = `Successfully ${executionType.toLowerCase()} ${opportunity.pair} arbitrage for +${opportunity.profit}% profit! ${opportunity.isLive ? '(Live Trade)' : '(Demo)'}`;
                showNotification(message, 'success');
                
            } catch (error) {
                console.error('Error executing arbitrage:', error);
                const errorMsg = opportunity.isLive ? 'Failed to execute live trade. Please try again.' : 'Failed to execute demo trade. Please try again.';
                showNotification(errorMsg, 'error');
            } finally {
                if (button) {
                    button.textContent = originalText;
                    button.disabled = false;
                }
            }
        }

        async function executeRealTrade(opportunity) {
            try {
                // Simulate real blockchain trade execution
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // In a real implementation, this would:
                // 1. Check wallet balance
                // 2. Calculate optimal trade size
                // 3. Execute buy order on first DEX
                // 4. Execute sell order on second DEX
                // 5. Handle slippage and fees
                // 6. Return transaction hashes
                
                addActivityItem(`Live trade executed on ICP blockchain`, `Hash: ${generateTransactionHash().slice(0, 8)}...`, 'live-trade');
                
            } catch (error) {
                throw new Error('Real trade execution failed: ' + error.message);
            }
        }

        async function executeSimulatedTrade(opportunity) {
            // Simulate trade execution delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            addActivityItem(`Demo trade simulated`, `Profit: +${opportunity.profit}%`, 'demo-trade');
        }

        function generateTransactionHash() {
            // Generate a realistic-looking transaction hash
            const chars = '0123456789abcdef';
            let hash = '';
            for (let i = 0; i < 64; i++) {
                hash += chars[Math.floor(Math.random() * chars.length)];
            }
            return hash;
        }

        async function fetchMarketData() {
            try {
                const now = Date.now();
                const baseValue = 12450;
                const arbitrageProfit = calculateArbitrageProfit();
                const marketMovement = (Math.random() - 0.5) * 200;
                
                const dataPoint = {
                    timestamp: now,
                    value: baseValue + arbitrageProfit + marketMovement,
                    arbitrageProfit: arbitrageProfit,
                    volume: Math.random() * 500000 + 100000,
                    icpPrice: 12.45 + (Math.random() - 0.5) * 2,
                    ckBTCPrice: 43250 + (Math.random() - 0.5) * 1000
                };

                portfolioData.push(dataPoint);
                
                if (portfolioData.length > 100) {
                    portfolioData = portfolioData.slice(-100);
                }

                updateCharts();
                updateMetrics();
                updateRealTimeStats();
            } catch (error) {
                console.error('Error fetching market data:', error);
            }
        }

        function calculateArbitrageProfit() {
            let totalProfit = 0;
            
            if (isLiveMode) {
                // Calculate based on real opportunities
                totalProfit = opportunities.reduce((sum, opp) => {
                    return sum + (parseFloat(opp.profit) * parseFloat(opp.volume) / 100);
                }, 0);
            } else {
                // Simulate arbitrage profit
                const priceDifferences = [
                    { pair: 'ICP/ckBTC', spread: 0.5, volume: 2000 },
                    { pair: 'ckBTC/ckUSDT', spread: 0.3, volume: 3000 },
                    { pair: 'ICP/ckUSDT', spread: 0.8, volume: 1500 },
                    { pair: 'ICP/CHAT', spread: 1.2, volume: 1000 }
                ];
                
                totalProfit = priceDifferences.reduce((sum, diff) => {
                    return sum + (diff.volume * diff.spread / 100) * 0.1;
                }, 0);
            }
            
            return totalProfit;
        }

        function updateRealTimeStats() {
            if (portfolioData.length > 0) {
                const latest = portfolioData[portfolioData.length - 1];
                const totalArbitrageProfit = portfolioData.reduce((sum, data) => sum + (data.arbitrageProfit || 0), 0);
                
                document.getElementById('dailyProfit').textContent = `$${totalArbitrageProfit.toFixed(2)}`;
                
                const profitChange = document.getElementById('profitChange');
                if (isLiveMode) {
                    profitChange.textContent = 'Live trading active';
                    profitChange.className = 'metric-change positive';
                } else {
                    profitChange.textContent = 'Demo mode active';
                    profitChange.className = 'metric-change';
                }
            }
        }

        function updateCharts() {
            if (charts.portfolio) {
                const labels = portfolioData.map(d => new Date(d.timestamp).toLocaleTimeString());
                const values = portfolioData.map(d => d.value);
                
                charts.portfolio.data.labels = labels;
                charts.portfolio.data.datasets[0].data = values;
                charts.portfolio.update('none');
            }
        }

        function updateMetrics() {
            if (portfolioData.length > 1) {
                const current = portfolioData[portfolioData.length - 1].value;
                const previous = portfolioData[portfolioData.length - 2].value;
                const change = current - previous;
                const changePercent = (change / previous * 100).toFixed(2);
                
                document.getElementById('portfolioValue').textContent = `$${current.toFixed(2)}`;
                document.getElementById('portfolioChange').textContent = 
                    `${change >= 0 ? '+' : ''}$${change.toFixed(2)} (${change >= 0 ? '+' : ''}${changePercent}%) today`;
                document.getElementById('portfolioChange').className = 
                    `metric-change ${change >= 0 ? 'positive' : 'negative'}`;
            }
        }

        function updateUserStats() {
            if (userData.length > 0) {
                const totalTrades = userData.length;
                const totalProfit = userData.reduce((sum, trade) => sum + (trade.profit_amount || 0), 0);
                
                document.getElementById('dailyProfit').textContent = `$${totalProfit.toFixed(2)}`;
            }
        }

        function addActivityItem(description, value, type) {
            const feed = document.getElementById('activityFeed');
            const iconClass = type === 'live-trade' ? 'live-trade-icon' : 
                             type === 'demo-trade' ? 'demo-trade-icon' :
                             type === 'trade' ? 'trade-icon' : 'profit-icon';
            
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <div class="activity-icon ${iconClass}"></div>
                <div style="flex: 1;">
                    <div>${description}</div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                        ${new Date().toLocaleTimeString()}
                    </div>
                </div>
                <div class="positive">${value}</div>
            `;
            
            feed.insertBefore(item, feed.firstChild);
            
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }

        function createWallet() {
            document.getElementById('walletCreationModal').style.display = 'flex';
            generateSeedPhrase();
        }

        function generateSeedPhrase() {
            const words = [
                'abandon', 'ability', 'able', 'about', 'above', 'absent', 'absorb', 'abstract',
                'absurd', 'abuse', 'access', 'accident', 'account', 'accuse', 'achieve', 'acid',
                'acoustic', 'acquire', 'across', 'act', 'action', 'actor', 'actress', 'actual',
                'adapt', 'add', 'addict', 'address', 'adjust', 'admit', 'adult', 'advance',
                'advice', 'aerobic', 'affair', 'afford', 'afraid', 'again', 'against', 'age',
                'agent', 'agree', 'ahead', 'aim', 'air', 'airport', 'aisle', 'alarm',
                'album', 'alcohol', 'alert', 'alien', 'all', 'alley', 'allow', 'almost',
                'alone', 'alpha', 'already', 'also', 'alter', 'always', 'amateur', 'amazing',
                'among', 'amount', 'amused', 'analyst', 'anchor', 'ancient', 'anger', 'angle',
                'angry', 'animal', 'ankle', 'announce', 'annual', 'another', 'answer', 'antenna',
                'antique', 'anxiety', 'any', 'apart', 'apology', 'appear', 'apple', 'approve',
                'april', 'arch', 'arctic', 'area', 'arena', 'argue', 'arm', 'armed',
                'armor', 'army', 'around', 'arrange', 'arrest', 'arrive', 'arrow', 'art'
            ];
            
            const seedPhrase = [];
            const crypto = window.crypto || window.msCrypto;
            
            for (let i = 0; i < 12; i++) {
                const randomArray = new Uint32Array(1);
                crypto.getRandomValues(randomArray);
                const randomIndex = randomArray[0] % words.length;
                seedPhrase.push(words[randomIndex]);
            }
            
            const seedContainer = document.getElementById('seedPhrase');
            seedContainer.innerHTML = '';
            seedPhrase.forEach((word, index) => {
                const wordElement = document.createElement('div');
                wordElement.className = 'seed-word';
                wordElement.textContent = `${index + 1}. ${word}`;
                seedContainer.appendChild(wordElement);
            });
            
            window.tempSeedPhrase = seedPhrase.join(' ');
            window.tempWalletAddress = generateWalletAddress(seedPhrase);
        }

        function generateWalletAddress(seedPhrase) {
            const seedString = seedPhrase.join('');
            let hash = 0;
            for (let i = 0; i < seedString.length; i++) {
                const char = seedString.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            const hex = Math.abs(hash).toString(16).padStart(8, '0');
            return `demo-${hex.slice(0, 5)}-${hex.slice(5, 10)}-${hex.slice(10, 15)}`;
        }

        async function confirmSeedPhrase() {
            if (!window.tempSeedPhrase || !window.tempWalletAddress) return;
            
            try {
                const walletData = {
                    address: window.tempWalletAddress,
                    seedPhrase: window.tempSeedPhrase,
                    created: new Date().toISOString()
                };
                
                localStorage.setItem('openarbWallet', JSON.stringify(walletData));
                
                if (window.dataSdk) {
                    await window.dataSdk.create({
                        wallet_address: window.tempWalletAddress,
                        seed_phrase: CryptoJS.AES.encrypt(window.tempSeedPhrase, 'user-key').toString(),
                        created_at: new Date().toISOString(),
                        last_login: new Date().toISOString(),
                        portfolio_value: 12450,
                        total_trades: 0
                    });
                }
                
                walletAddress = window.tempWalletAddress;
                isConnected = true;
                isLiveMode = false; // Demo mode
                
                delete window.tempSeedPhrase;
                delete window.tempWalletAddress;
                
                updateTradingModeIndicator();
                showMainApp();
                closeModal();
                
                showNotification('Demo wallet created successfully!', 'success');
                
            } catch (error) {
                console.error('Error creating wallet:', error);
                showNotification('Failed to create wallet. Please try again.', 'error');
            }
        }

        function importWallet() {
            document.getElementById('importWalletModal').style.display = 'flex';
        }

        async function confirmImportWallet() {
            const seedInput = document.getElementById('importSeedPhrase');
            const seedPhrase = seedInput.value.trim();
            
            if (!seedPhrase) {
                showNotification('Please enter your seed phrase.', 'error');
                return;
            }
            
            const words = seedPhrase.split(/\s+/);
            if (words.length !== 12) {
                showNotification('Seed phrase must be exactly 12 words.', 'error');
                return;
            }
            
            try {
                const address = generateWalletAddress(words);
                
                const walletData = {
                    address: address,
                    seedPhrase: seedPhrase,
                    imported: new Date().toISOString()
                };
                
                localStorage.setItem('openarbWallet', JSON.stringify(walletData));
                
                walletAddress = address;
                isConnected = true;
                isLiveMode = false; // Demo mode
                
                updateTradingModeIndicator();
                showMainApp();
                closeModal();
                
                showNotification('Demo wallet imported successfully!', 'success');
                
            } catch (error) {
                console.error('Error importing wallet:', error);
                showNotification('Failed to import wallet. Please check your seed phrase.', 'error');
            }
        }

        function connectExistingWallet() {
            try {
                const walletData = JSON.parse(localStorage.getItem('openarbWallet'));
                const plugConnected = localStorage.getItem('openarbPlugConnected');
                
                if (plugConnected === 'true') {
                    // Try to reconnect to Plug
                    connectPlugWallet();
                } else if (walletData && walletData.address) {
                    // Connect demo wallet
                    walletAddress = walletData.address;
                    isConnected = true;
                    isLiveMode = false;
                    updateTradingModeIndicator();
                    showMainApp();
                }
            } catch (error) {
                console.error('Error connecting existing wallet:', error);
                localStorage.removeItem('openarbWallet');
                localStorage.removeItem('openarbPlugConnected');
            }
        }

        function showMainApp() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('walletDisplay').textContent = walletAddress;
            
            initializeCharts();
            startActivityFeed();
            addExplanationButton();
            
            // Start live data feeds now that we're connected
            initializeLiveData();
        }

        function initializeCharts() {
            const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
            charts.portfolio = new Chart(portfolioCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [],
                        borderColor: isLiveMode ? '#00ff88' : '#00d4ff',
                        backgroundColor: isLiveMode ? 'rgba(0, 255, 136, 0.1)' : 'rgba(0, 212, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                        }
                    }
                }
            });

            const allocationCtx = document.getElementById('allocationChart').getContext('2d');
            charts.allocation = new Chart(allocationCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ICP', 'ckBTC', 'ckUSDC', 'ckUSDT', 'CHAT'],
                    datasets: [{
                        data: [40, 25, 15, 12, 8],
                        backgroundColor: [
                            '#00d4ff',
                            '#f7931a',
                            '#2775ca',
                            '#26a17b',
                            '#00ff88'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'rgba(255, 255, 255, 0.7)' }
                        }
                    }
                }
            });

            const historyCtx = document.getElementById('historyChart').getContext('2d');
            charts.history = new Chart(historyCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Daily Profit',
                        data: [45, 67, 23, 89, 56, 78, 34],
                        backgroundColor: isLiveMode ? 'rgba(0, 255, 136, 0.8)' : 'rgba(0, 212, 255, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                        }
                    }
                }
            });
        }

        function startActivityFeed() {
            addActivityItem('OpenArb initialized', 'SUCCESS', 'profit');
            
            if (isLiveMode) {
                addActivityItem('Connected to ICP blockchain', 'LIVE', 'live-trade');
                addActivityItem('Plug wallet connected', 'SECURE', 'profit');
            } else {
                addActivityItem('Demo mode activated', 'SAFE', 'demo-trade');
                addActivityItem('Simulated trading ready', 'READY', 'profit');
            }
            
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const activities = [
                        'Price feed updated from Sonic DEX',
                        'ICPSwap liquidity scan completed',
                        'InfinitySwap price comparison active',
                        'Cross-DEX arbitrage opportunity detected',
                        'Portfolio rebalancing analysis',
                        'Risk management check passed',
                        'Market volatility assessment',
                        'Trading pair correlation updated'
                    ];
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    const value = isLiveMode ? 'LIVE' : 'DEMO';
                    addActivityItem(activity, value, Math.random() > 0.5 ? 'trade' : 'profit');
                }
            }, 15000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
        }

        function disconnectWallet() {
            localStorage.removeItem('openarbWallet');
            localStorage.removeItem('openarbPlugConnected');
            isConnected = false;
            isLiveMode = false;
            plugWallet = null;
            icpAgent = null;
            walletAddress = '';
            dexConnections = {};
            
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
            
            showNotification('Wallet disconnected successfully.', 'success');
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            document.getElementById('importSeedPhrase').value = '';
        }

        function viewSeedPhrase() {
            const walletData = JSON.parse(localStorage.getItem('openarbWallet') || '{}');
            if (!walletData.seedPhrase) {
                showNotification('No seed phrase found.', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Your Seed Phrase</h2>
                    <p style="color: #ff6b6b; margin-bottom: 20px;">
                        WARNING: Never share your seed phrase with anyone. Store it safely offline.
                    </p>
                    <div class="seed-grid">
                        ${walletData.seedPhrase.split(' ').map((word, i) => 
                            `<div class="seed-word">${i + 1}. ${word}</div>`
                        ).join('')}
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="this.closest('.modal').remove()">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function exportWallet() {
            const walletData = JSON.parse(localStorage.getItem('openarbWallet') || '{}');
            if (!walletData.address) {
                showNotification('No wallet found to export.', 'error');
                return;
            }
            
            const exportData = {
                address: walletData.address,
                seedPhrase: walletData.seedPhrase,
                exported: new Date().toISOString(),
                platform: 'OpenArb',
                mode: isLiveMode ? 'live' : 'demo'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `openarb-wallet-${walletData.address.slice(0, 8)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Wallet exported successfully!', 'success');
        }

        function deleteWallet() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Delete Wallet</h2>
                    <p style="color: #ff6b6b; margin-bottom: 20px;">
                        This action cannot be undone. Make sure you have backed up your seed phrase.
                    </p>
                    <p>Type "DELETE" to confirm:</p>
                    <input type="text" id="deleteConfirmation" 
                           style="width: 100%; padding: 12px; margin: 10px 0; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 8px; color: white;">
                    <div style="margin-top: 20px;">
                        <button class="btn" style="background: linear-gradient(45deg, #ff4757, #ff3742);" onclick="confirmDeleteWallet()">Delete Wallet</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmDeleteWallet() {
            const confirmation = document.getElementById('deleteConfirmation').value;
            if (confirmation !== 'DELETE') {
                showNotification('Please type "DELETE" to confirm.', 'error');
                return;
            }
            
            localStorage.removeItem('openarbWallet');
            localStorage.removeItem('openarbPlugConnected');
            document.querySelector('.modal').remove();
            disconnectWallet();
            showNotification('Wallet deleted successfully.', 'success');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(0, 255, 136, 0.9)' : 
                            type === 'error' ? 'rgba(255, 71, 87, 0.9)' :
                            type === 'warning' ? 'rgba(255, 193, 7, 0.9)' :
                            'rgba(0, 212, 255, 0.9)'};
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        function showBeginnerGuide() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
                    <h2 style="text-align: center; color: #00ff88;">Complete Beginner's Guide to OpenArb</h2>
                    <div id="beginnerGuideContent">
                        <div class="explanation-section" style="background: rgba(0, 255, 136, 0.1); border-left-color: #00ff88;">
                            <h3>What is Arbitrage Trading?</h3>
                            <p><strong>Simple explanation:</strong> Imagine apples cost $1 at Store A and $1.20 at Store B. You could buy apples from Store A and sell them to Store B for a 20¢ profit per apple!</p>
                            <p><strong>In crypto:</strong> Different exchanges have slightly different prices for the same tokens. OpenArb finds these price differences and helps you profit from them automatically.</p>
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>Example:</strong><br>
                                • ICP costs $12.00 on Sonic DEX<br>
                                • ICP costs $12.30 on ICPSwap<br>
                                • <span style="color: #00ff88;">Profit opportunity: 2.5%!</span>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Step-by-Step: Your First Trade</h3>
                            <ol style="line-height: 1.8;">
                                <li><strong>Click "Create Demo Wallet"</strong> - This is 100% safe, no real money involved</li>
                                <li><strong>Save your seed phrase</strong> - Write down the 12 words shown (demo only, but good practice)</li>
                                <li><strong>Explore the dashboard</strong> - See your simulated portfolio and live market data</li>
                                <li><strong>Go to "Live Opportunities"</strong> - Watch for profitable trades (green = good!)</li>
                                <li><strong>Click "Execute Demo"</strong> - Try your first simulated trade</li>
                                <li><strong>Check "Trade History"</strong> - See your profits accumulate</li>
                            </ol>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Key Concepts to Understand</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00d4ff; margin-bottom: 8px;">Profit Threshold</h4>
                                    <p style="font-size: 14px;">Minimum profit % to consider a trade. Start with 1.5% - higher is safer but fewer opportunities.</p>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00d4ff; margin-bottom: 8px;">Slippage</h4>
                                    <p style="font-size: 14px;">Price can change while you trade. 1% slippage = prices can move 1% and trade still executes.</p>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00d4ff; margin-bottom: 8px;">Auto-Execution</h4>
                                    <p style="font-size: 14px;">Let OpenArb trade automatically when profit > 2%. Great for busy people!</p>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00d4ff; margin-bottom: 8px;">DEX</h4>
                                    <p style="font-size: 14px;">Decentralized Exchange - like Sonic, ICPSwap. No middleman, you trade directly.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Safety First: Demo vs Live Mode</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="background: rgba(0, 255, 136, 0.1); padding: 20px; border-radius: 12px; border: 1px solid #00ff88;">
                                    <h4 style="color: #00ff88; text-align: center;">DEMO MODE (Recommended)</h4>
                                    <ul style="margin-top: 15px;">
                                        <li>100% safe - no real money</li>
                                        <li>Learn without risk</li>
                                        <li>Practice strategies</li>
                                        <li>Understand the interface</li>
                                        <li>See real market data</li>
                                    </ul>
                                </div>
                                <div style="background: rgba(255, 107, 53, 0.1); padding: 20px; border-radius: 12px; border: 1px solid #ff6b35;">
                                    <h4 style="color: #ff6b35; text-align: center;">LIVE MODE (Advanced)</h4>
                                    <ul style="margin-top: 15px;">
                                        <li>Real money at risk</li>
                                        <li>Requires Plug wallet</li>
                                        <li>Need ICP tokens</li>
                                        <li>Blockchain fees apply</li>
                                        <li>Real profits possible</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Understanding the Dashboard</h3>
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div>
                                        <h4 style="color: #00d4ff;">Portfolio Value</h4>
                                        <p style="font-size: 14px;">Your total account value. In demo mode, this starts at $12,450 (fake money for practice).</p>
                                    </div>
                                    <div>
                                        <h4 style="color: #00d4ff;">Active Opportunities</h4>
                                        <p style="font-size: 14px;">Number of profitable trades available right now. More = more chances to profit!</p>
                                    </div>
                                    <div>
                                        <h4 style="color: #00d4ff;">Daily Profit</h4>
                                        <p style="font-size: 14px;">How much you've earned today from arbitrage. Goal: consistent daily profits!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Practice Exercises</h3>
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 20px; border-radius: 12px;">
                                <h4 style="color: #00d4ff; margin-bottom: 15px;">Try These in Demo Mode:</h4>
                                <ol style="line-height: 1.8;">
                                    <li><strong>Execute 3 manual trades</strong> - Click opportunities with 1.5%+ profit</li>
                                    <li><strong>Enable auto-execution</strong> - Let it run for 5 minutes, watch it work</li>
                                    <li><strong>Adjust profit threshold</strong> - Try 2%, see how opportunities change</li>
                                    <li><strong>Check different trading pairs</strong> - ICP/ckBTC vs ICP/CHAT</li>
                                    <li><strong>Monitor for 30 minutes</strong> - See how profits accumulate</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Ready for Live Trading?</h3>
                            <div style="background: rgba(255, 193, 7, 0.1); padding: 20px; border-radius: 12px; border: 1px solid #ffc107;">
                                <h4 style="color: #ffc107;">Before Going Live, Make Sure You:</h4>
                                <ul style="margin-top: 15px; line-height: 1.6;">
                                    <li>Practiced in demo mode for at least 1 hour</li>
                                    <li>Understand profit thresholds and slippage</li>
                                    <li>Have Plug wallet installed and funded with ICP</li>
                                    <li>Start with small amounts (under $100)</li>
                                    <li>Know that crypto trading involves risk</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Common Beginner Questions</h3>
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00ff88;">Q: Is this really profitable?</h4>
                                    <p style="font-size: 14px;">A: Yes! Arbitrage is a proven strategy. However, profits depend on market conditions, your settings, and timing. Demo mode shows realistic scenarios.</p>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00ff88;">Q: How much money do I need to start?</h4>
                                    <p style="font-size: 14px;">A: Demo mode is free! For live trading, start with $50-100 to learn. More capital = more profit potential, but also more risk.</p>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                    <h4 style="color: #00ff88;">Q: What if I lose money?</h4>
                                    <p style="font-size: 14px;">A: Arbitrage is lower risk than regular trading, but losses are possible due to fees, slippage, or market changes. Always start small!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 30px; text-align: center; display: flex; gap: 15px; justify-content: center;">
                        <button class="btn" onclick="this.closest('.modal').remove(); createWallet();" style="background: linear-gradient(45deg, #00ff88, #00d4ff);">
                            Start Demo Trading Now
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove();">
                            Continue Reading
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showPlatformExplanation() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <h2>OpenArb - Live ICP Trading Platform</h2>
                    <div id="explanationContent">
                        <div class="explanation-section">
                            <h3>What's New?</h3>
                            <p>OpenArb introduces <strong>real blockchain integration</strong> with the Internet Computer Protocol. Connect your Plug wallet to execute actual arbitrage trades across ICP DEXes, or use demo mode to learn and practice.</p>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Core Trading Pairs (Phase 1)</h3>
                            <ul>
                                <li><strong>ICP/ckBTC</strong> - Internet Computer to Chain-key Bitcoin</li>
                                <li><strong>ckBTC/ckUSDT</strong> - Chain-key Bitcoin to Tether</li>
                                <li><strong>ICP/ckUSDT</strong> - Internet Computer to Tether</li>
                                <li><strong>ICP/CHAT</strong> - Internet Computer to OpenChat token</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Supported ICP DEXes</h3>
                            <ul>
                                <li><strong>Sonic DEX</strong> - High-speed AMM with ultra-low fees</li>
                                <li><strong>ICPSwap</strong> - Leading decentralized exchange on ICP</li>
                                <li><strong>InfinitySwap</strong> - Multi-chain DEX aggregator</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Live Trading Features</h3>
                            <ul>
                                <li><strong>Plug Wallet Integration</strong> - Connect your real ICP wallet</li>
                                <li><strong>Real-time Price Monitoring</strong> - 3-second updates from DEX canisters</li>
                                <li><strong>Auto-execution</strong> - Automatic trading for 2%+ profit opportunities</li>
                                <li><strong>Blockchain Recording</strong> - All trades recorded on ICP ledger</li>
                                <li><strong>Non-custodial Security</strong> - Your keys, your funds</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>How Arbitrage Works</h3>
                            <ol>
                                <li><strong>Price Scanning:</strong> Monitors prices across Sonic, ICPSwap, and InfinitySwap</li>
                                <li><strong>Opportunity Detection:</strong> Identifies profitable price differences</li>
                                <li><strong>Smart Execution:</strong> Simultaneously buys low and sells high</li>
                                <li><strong>Profit Capture:</strong> Captures price difference minus fees</li>
                            </ol>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Trading Modes</h3>
                            <ul>
                                <li><strong>🟢 LIVE Mode:</strong> Real blockchain trading with Plug wallet</li>
                                <li><strong>🔴 DEMO Mode:</strong> Safe simulation for learning</li>
                                <li><strong>Auto-execution:</strong> Optional automatic trading</li>
                                <li><strong>Manual Control:</strong> Execute trades individually</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Getting Started</h3>
                            <ol>
                                <li><strong>Connect Plug Wallet:</strong> For live ICP blockchain trading</li>
                                <li><strong>Or Create Demo Wallet:</strong> For safe practice trading</li>
                                <li><strong>Configure Settings:</strong> Set profit thresholds and risk limits</li>
                                <li><strong>Start Trading:</strong> Manual execution or auto-trading</li>
                            </ol>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Expansion Roadmap (Phase 2)</h3>
                            <ul>
                                <li><strong>ICP/OGY:</strong> Origyn token integration</li>
                                <li><strong>stICP/ICP:</strong> Staked ICP arbitrage</li>
                                <li><strong>ckBTC/ICP:</strong> Multi-DEX Bitcoin comparison</li>
                                <li><strong>More SNS Tokens:</strong> Additional ecosystem tokens</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-section">
                            <h3>Security & Risk</h3>
                            <ul>
                                <li><strong>Non-custodial:</strong> Private keys never leave your device</li>
                                <li><strong>Smart Contract Audited:</strong> ICP canister security verified</li>
                                <li><strong>Risk Management:</strong> Configurable limits and thresholds</li>
                                <li><strong>Demo Mode:</strong> Practice without real funds</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn" onclick="this.closest('.modal').remove()">Start Trading!</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function addExplanationButton() {
            const walletSection = document.querySelector('.wallet-section');
            if (walletSection) {
                const explainBtn = document.createElement('button');
                explainBtn.className = 'btn btn-secondary';
                explainBtn.textContent = 'How It Works';
                explainBtn.onclick = showPlatformExplanation;
                explainBtn.style.marginRight = '10px';
                walletSection.insertBefore(explainBtn, walletSection.firstChild);
            }
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .explanation-section {
                margin-bottom: 25px;
                padding: 20px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                border-left: 4px solid #00d4ff;
            }
            .explanation-section h3 {
                color: #00d4ff;
                margin-bottom: 15px;
                font-size: 18px;
            }
            .explanation-section p, .explanation-section li {
                color: rgba(255, 255, 255, 0.9);
                line-height: 1.6;
                margin-bottom: 8px;
            }
            .explanation-section ul, .explanation-section ol {
                padding-left: 20px;
            }
            .explanation-section strong {
                color: #00ff88;
            }
        `;
        document.head.appendChild(style);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'996b6c1bc73a4eb9',t:'MTc2MTgzMjY1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>